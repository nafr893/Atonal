{% assign ticket_unit_cents = 10000 %}

<section style="padding: 24px; border: 1px solid rgba(0,0,0,.12); border-radius: 0px;">
  {% if customer %}
    {% assign promo_spend_cents = customer.metafields.loyalty.promo_spend_cents.value | default: 0 %}
    {% assign tickets = customer.metafields.loyalty.tickets_balance.value | default: 0 %}
    {% assign remainder_cents = customer.metafields.loyalty.tickets_remainder_cents.value | default: 0 %}

    {% assign progress_percent = remainder_cents | times: 100 | divided_by: ticket_unit_cents %}
    {% assign cents_to_next = ticket_unit_cents | minus: remainder_cents %}
    {% if remainder_cents == 0 %}{% assign cents_to_next = 0 %}{% endif %}
    {% assign dollars_to_next = cents_to_next | divided_by: 100 %}

    <div style="display:flex; align-items:baseline; justify-content:space-between; gap:16px;">
      <h2 style="margin:0; font-size: 22px;">Giveaway Status</h2>
      <div style="font-size: 14px; opacity:.75;">
       Amount Spent: {{ promo_spend_cents | money }}
      </div>
    </div>

    <div style="margin-top: 14px;">
      <div style="font-size: 36px; font-weight: 700; line-height: 1;">
        {{ tickets }} <span style="font-size: 16px; font-weight: 600; opacity:.8;">ticket{% if tickets != 1 %}s{% endif %}</span>
      </div>

      <div style="margin-top: 10px; font-size: 14px; opacity:.85;">
        Spend <strong>${{ dollars_to_next }}</strong> more to earn your next ticket.
      </div>
    </div>

    <div style="margin-top: 14px;">
      <div style="height: 10px; background: rgba(0,0,0,.10); border-radius: 999px; overflow:hidden;">
        <div style="height: 100%; width: {{ progress_percent }}%; background: rgba(0,0,0,.85);"></div>
      </div>

      <div style="margin-top: 8px; display:flex; justify-content:space-between; font-size: 12px; opacity:.75;">
        <span>{{ progress_percent }}% to next ticket</span>
        <span>$100 = 1 ticket</span>
      </div>
    </div>

  {% else %}
    <h2 style="margin:0 0 10px; font-size: 22px;">Giveaway Status</h2>
    <p style="margin:0 0 12px; opacity:.85;">Log in to see your tickets and progress.</p>
    <a href="{{ routes.account_login_url }}" style="display:inline-block; padding:10px 14px; border:1px solid rgba(0,0,0,.2); border-radius: 10px; text-decoration:none;">
      Log in
    </a>
  {% endif %}
</section>

{% schema %}
{
  "name": "Giveaway status",
  "settings": [],
  "presets": [{ "name": "Giveaway status" }]
}
{% endschema %}
